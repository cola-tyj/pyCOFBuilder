#!/bin/sh

#PBS -l walltime=100:00:00
#PBS -l select=2:ncpus=48:mpiprocs=48
#PBS -N C3_TPOB_CHO_H_H-C2_BENZ_NH2_H_O-HCB_A-AA
#PBS -m bea 
#PBS -j oe
#PBS -V

cd ${PBS_O_WORKDIR}

module load intel/2018.4

PSEUDO_DIR="/home/users/lipelopes/pseudo"
CMD_PW="mpirun -np 96 /home/users/lipelopes/qe-6.4/bin/pw.x -nk 2"
PREFIX='C3_TPOB_CHO_H_H-C2_BENZ_NH2_H_O-HCB_A-AA'
CALC='vc-relax'
SCRATCH_DIR='/scratch/31081a/lipelopes/C3_TPOB_CHO_H_H-C2_BENZ_NH2_H_O-HCB_A-AA/'

cat>$PREFIX.$CALC.in<<EOF
 &control
    calculation = '$CALC' ,
    restart_mode = 'from_scratch' ,
    wf_collect = .false. ,
    outdir = '$SCRATCH_DIR' ,
    pseudo_dir = '$PSEUDO_DIR' ,
    prefix = '$PREFIX' ,
    verbosity ='high' ,
    tstress = .true. ,
    tprnfor = .true. ,
    etot_conv_thr = 1.0d-4 ,
    forc_conv_thr = 1.0d-5 ,
    nstep=1000 ,
 / 
 &system
    ibrav =   4
    celldm(1) =   74.26885121
    celldm(3) =   0.09159982
    nat =     132
    ntyp =     4
    ecutwfc = 40 
    ecutrho = 360 
    !occupations='smearing' , 
    !degauss=0.001 , 
    !smearing='gaussian' , 
    vdw_corr='grimme-d3' , 
 / 
 &electrons
    conv_thr =  1.0D-8 ,
    electron_maxstep = 100 ,
    mixing_beta = 0.3 ,
 / 
 &IONS
    ion_dynamics = 'bfgs'
 / 
 &CELL
    cell_dynamics = 'bfgs'
    cell_dofree = 'ibrav'
 / 
ATOMIC_SPECIES
 N   14.0067  N.pbe-n-rrkjus_psl.1.0.0.UPF
 H   1.0079  H.pbe-rrkjus_psl.1.0.0.UPF
 C   12.0107  C.pbe-n-rrkjus_psl.1.0.0.UPF
 O   15.9994  O.pbe-n-rrkjus_psl.1.0.0.UPF

ATOMIC_POSITIONS (crystal)
H        0.895808262    0.491999944    0.500000000
H        0.963262189    0.536737812    0.500000000
H        0.104191738    0.508000056    0.500000000
H        0.036737811    0.463262188    0.500000000
H        0.573475623    0.036737811    0.500000000
H        0.596191682    0.104191738    0.500000000
H        0.403808318    0.895808262    0.500000000
H        0.426524377    0.963262189    0.500000000
H        0.536243695    0.357411966    0.500000000
H        0.602029440    0.331569228    0.500000000
H        0.593642375    0.346342289    0.500000000
H        0.673309657    0.471801178    0.500000000
H        0.615760824    0.483072220    0.500000000
H        0.821168270    0.463756305    0.500000000
H        0.729539787    0.397970560    0.500000000
H        0.752699914    0.406357625    0.500000000
H        0.798491521    0.326690343    0.500000000
H        0.867311396    0.384239176    0.500000000
H        0.642588034    0.178831730    0.500000000
H        0.668430772    0.270460213    0.500000000
H        0.653657711    0.247300086    0.500000000
H        0.528198822    0.201508479    0.500000000
H        0.516927780    0.132688604    0.500000000
H        0.536737812    0.573475623    0.500000000
H        0.491999944    0.596191682    0.500000000
H        0.508000056    0.403808318    0.500000000
H        0.463262188    0.426524377    0.500000000
H        0.463756305    0.642588034    0.500000000
H        0.397970560    0.668430772    0.500000000
H        0.406357625    0.653657711    0.500000000
H        0.326690343    0.528198822    0.500000000
H        0.384239176    0.516927780    0.500000000
H        0.178831730    0.536243695    0.500000000
H        0.270460213    0.602029440    0.500000000
H        0.247300086    0.593642375    0.500000000
H        0.201508479    0.673309657    0.500000000
H        0.132688604    0.615760824    0.500000000
H        0.357411966    0.821168270    0.500000000
H        0.331569228    0.729539787    0.500000000
H        0.346342289    0.752699914    0.500000000
H        0.471801178    0.798491521    0.500000000
H        0.483072220    0.867311396    0.500000000
C        0.887781641    0.460600134    0.500000000
C        0.958819596    0.479409798    0.500000000
C        0.979409798    0.520590204    0.500000000
C        0.020590202    0.541180406    0.500000000
C        0.112218359    0.539399866    0.500000000
C        0.041180404    0.520590202    0.500000000
C        0.020590202    0.479409796    0.500000000
C        0.979409798    0.458819594    0.500000000
C        0.541180406    0.020590202    0.500000000
C        0.520590204    0.979409798    0.500000000
C        0.572818493    0.112218359    0.500000000
C        0.520590202    0.041180404    0.500000000
C        0.427181507    0.887781641    0.500000000
C        0.479409798    0.958819596    0.500000000
C        0.458819594    0.979409798    0.500000000
C        0.479409796    0.020590202    0.500000000
C        0.566370829    0.382550388    0.500000000
C        0.630252201    0.332863422    0.500000000
C        0.598114502    0.375962836    0.500000000
C        0.666006216    0.368090874    0.500000000
C        0.572711977    0.420839256    0.500000000
C        0.643259497    0.447343703    0.500000000
C        0.610970033    0.453017792    0.500000000
C        0.635965164    0.408707172    0.500000000
C        0.816179559    0.433629171    0.500000000
C        0.702611221    0.369747799    0.500000000
C        0.777848334    0.401885498    0.500000000
C        0.702084658    0.333993784    0.500000000
C        0.848127279    0.427288023    0.500000000
C        0.804084206    0.356740503    0.500000000
C        0.842047759    0.389029967    0.500000000
C        0.772742008    0.364034836    0.500000000
C        0.617449612    0.183820441    0.500000000
C        0.667136578    0.297388779    0.500000000
C        0.624037164    0.222151666    0.500000000
C        0.631909126    0.297915342    0.500000000
C        0.579160744    0.151872721    0.500000000
C        0.552656297    0.195915794    0.500000000
C        0.546982208    0.157952241    0.500000000
C        0.591292828    0.227257992    0.500000000
C        0.520590204    0.541180406    0.500000000
C        0.541180406    0.520590204    0.500000000
C        0.460600134    0.572818493    0.500000000
C        0.479409798    0.520590202    0.500000000
C        0.539399866    0.427181507    0.500000000
C        0.520590202    0.479409798    0.500000000
C        0.479409796    0.458819594    0.500000000
C        0.458819594    0.479409796    0.500000000
C        0.433629171    0.617449612    0.500000000
C        0.369747799    0.667136578    0.500000000
C        0.401885498    0.624037164    0.500000000
C        0.333993784    0.631909126    0.500000000
C        0.427288023    0.579160744    0.500000000
C        0.356740503    0.552656297    0.500000000
C        0.389029967    0.546982208    0.500000000
C        0.364034836    0.591292828    0.500000000
C        0.183820441    0.566370829    0.500000000
C        0.297388779    0.630252201    0.500000000
C        0.222151666    0.598114502    0.500000000
C        0.297915342    0.666006216    0.500000000
C        0.151872721    0.572711977    0.500000000
C        0.195915794    0.643259497    0.500000000
C        0.157952241    0.610970033    0.500000000
C        0.227257992    0.635965164    0.500000000
C        0.382550388    0.816179559    0.500000000
C        0.332863422    0.702611221    0.500000000
C        0.375962836    0.777848334    0.500000000
C        0.368090874    0.702084658    0.500000000
C        0.420839256    0.848127279    0.500000000
C        0.447343703    0.804084206    0.500000000
C        0.453017792    0.842047759    0.500000000
C        0.408707172    0.772742008    0.500000000
N        0.918244909    0.459122455    0.500000000
N        0.081755091    0.540877545    0.500000000
N        0.540877546    0.081755091    0.500000000
N        0.459122454    0.918244909    0.500000000
N        0.459122455    0.540877546    0.500000000
N        0.540877545    0.459122454    0.500000000
O        0.040198118    0.580396238    0.500000000
O        0.959801882    0.419603762    0.500000000
O        0.540198120    0.959801882    0.500000000
O        0.459801880    0.040198118    0.500000000
O        0.669668953    0.404907792    0.500000000
O        0.735238839    0.330331047    0.500000000
O        0.595092208    0.264761161    0.500000000
O        0.580396238    0.540198120    0.500000000
O        0.419603762    0.459801880    0.500000000
O        0.330331047    0.595092208    0.500000000
O        0.264761161    0.669668953    0.500000000
O        0.404907792    0.735238839    0.500000000
K_POINTS automatic
   1 1 6  1 1 1
EOF
$CMD_PW < $PREFIX.$CALC.in > $PREFIX.$CALC.out